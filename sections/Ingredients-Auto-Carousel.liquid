<div class="ingredients-section">
  <div class="ingredients-header">
    <h2>{{ section.settings.heading }}</h2>
    <p>{{ section.settings.subtext }}</p>
  </div>

  <div class="ingredients-slider-wrapper">
    <div class="ingredients-slider">
      {% for block in section.blocks %}
        <div class="ingredient-item">
          <div class="ingredient-content">
            <img src="{{ block.settings.image | img_url: '500x' }}" alt="{{ block.settings.title }}">
            <h3>{{ block.settings.title }}</h3>
            <p>{{ block.settings.text }}</p>
          </div>
        </div>
      {% endfor %}
    </div>
  </div>
</div>

<style>
.ingredients-section {
  overflow: hidden;
  width: 100%;
  padding: 40px 0;
}

.ingredients-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 70px;
  padding: 0 30px;
  flex-wrap: wrap;
}

.ingredients-header h2 {
  font-size: 28px;
  font-weight: 600;
  margin: -10px 0 0;
}

.ingredients-header p {
  max-width: 400px;
  font-size: 16px;
  color: #444;
  margin: -10px 0 0;
}

.ingredients-slider-wrapper {
  overflow: hidden;
  width: 100%;
}

.ingredients-slider {
  display: flex;
  gap: 20px; /* original spacing restored */
  transition: transform 0.6s ease-in-out;
  will-change: transform;
}

.ingredient-item {
  flex: 0 0 calc(100% / 3.5); /* original width preserved (3.5 items on desktop) */
}

.ingredient-content {
  width: 80%;          /* same proportions as before */
  max-width: 700px;
  margin: 0 auto;
  text-align: left;
}

.ingredient-content img {
  width: 100%;
  height: 290px;       /* fixed equal height */
  border-radius: 10px;
  display: block;
  object-fit: cover;   /* crop neatly */
  object-position: center;
}

.ingredient-content h3 {
  font-size: 18px;
  font-weight: 700;
  margin: 10px 0 5px;
}

.ingredient-content p {
  font-size: 14px;
  color: #000;
}

/* Tablets */
@media (max-width: 1024px) {
  .ingredient-item {
    flex: 0 0 calc(100% / 2.2); /* show ~2 items */
  }

  .ingredients-header {
    flex-direction: column;
    align-items: flex-start;
    margin-bottom: 40px;
  }

  .ingredients-header h2 {
    font-size: 24px;
    margin-bottom: 10px;
  }

  .ingredients-header p {
    font-size: 15px;
    max-width: 100%;
  }
}

/* Mobile */
@media (max-width: 768px) {
  .ingredient-item {
    flex: 0 0 calc(100% / 1.2); /* ~1.2 items peek */
  }

  .ingredients-header {
    padding: 0 15px;
  }

  .ingredients-header h2 {
    font-size: 20px;
  }

  .ingredients-header p {
    font-size: 14px;
  }

  .ingredient-content h3 {
    font-size: 16px;
  }

  .ingredient-content p {
    font-size: 13px;
  }
}

/* Extra Small */
@media (max-width: 480px) {
  .ingredient-item {
    flex: 0 0 100%; /* full width 1 card */
  }

  .ingredients-header h2 {
    font-size: 18px;
  }

  .ingredients-header p {
    font-size: 13px;
  }
}
</style>

<script>
document.addEventListener("DOMContentLoaded", function() {
  const slider = document.querySelector('.ingredients-slider');
  const wrapper = document.querySelector('.ingredients-slider-wrapper');
  const items = slider.children;
  const totalItems = items.length;
  let index = 0;
  let interval;

  // Duplicate items for infinite loop
  slider.innerHTML += slider.innerHTML;

  function slideNext() {
    index++;
    const itemWidth = items[0].offsetWidth + 20; // include original 20px gap
    slider.style.transform = `translateX(-${index * itemWidth}px)`;

    if (index >= totalItems) {
      setTimeout(() => {
        slider.style.transition = "none";
        index = 0;
        slider.style.transform = "translateX(0)";
        setTimeout(() => {
          slider.style.transition = "transform 0.6s ease-in-out";
        });
      }, 700);
    }
  }

  function startAuto() {
    interval = setInterval(slideNext, 2000);
  }

  function stopAuto() {
    clearInterval(interval);
  }

  // Start autoplay
  startAuto();

  // Touch/drag swipe functionality
  let startX = 0;
  let moveX = 0;
  let isDragging = false;

  wrapper.addEventListener("touchstart", (e) => {
    stopAuto();
    startX = e.touches[0].clientX;
    isDragging = true;
  });

  wrapper.addEventListener("touchmove", (e) => {
    if (!isDragging) return;
    moveX = e.touches[0].clientX - startX;
    slider.style.transition = "none";
    slider.style.transform = `translateX(calc(${-index * (items[0].offsetWidth + 20)}px + ${moveX}px))`;
  });

  wrapper.addEventListener("touchend", () => {
    isDragging = false;
    if (Math.abs(moveX) > 50) {
      if (moveX < 0) index++;
      else if (index > 0) index--;
    }
    slider.style.transition = "transform 0.6s ease-in-out";
    slider.style.transform = `translateX(-${index * (items[0].offsetWidth + 20)}px)`;
    moveX = 0;
    startAuto();
  });
});
</script>

{% schema %}
{
  "name": "Ingredients Auto Carousel",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Section Heading",
      "default": "What we're made of"
    },
    {
      "type": "textarea",
      "id": "subtext",
      "label": "Section Subtext",
      "default": "Our formulas are clean without compromise because your skin deserves efficacy, not just aesthetics."
    }
  ],
  "blocks": [
    {
      "type": "ingredient",
      "name": "Ingredient",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Title"
        },
        {
          "type": "textarea",
          "id": "text",
          "label": "Description"
        }
      ]
    }
  ],
  "max_blocks": 12,
  "presets": [
    {
      "name": "Ingredients Auto Carousel"
    }
  ]
}
{% endschema %}